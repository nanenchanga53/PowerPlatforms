# D365 앱(Power Apps) 오프라인 모드
> D365 모바일 앱은 오프라인 모드를 지원한다. 여기서는 오프라인 모드에서 어떤게 가능한지 충돌이 일어나면 어떻게 해야되는지 알아본다.

## 오프라인모드 설정 방법
> D365 모바일 앱을 실행해서 인터넷을 끊는다고 오프라인모드가 되지 않는다.(Field Service Mobile App의 경우는 인터넷이 끊기면 오프라인모드가 된다.) 그냥 데이터를 볼 수 없게 되기때문에 밑작업이 필요하다.

1. 모델 기반 앱의 오프라인 모드를 구성하려면 환경 제작자, 시스템 관리자 또는 시스템 사용자 지정자 역할이 필요하다.

2. 기본 사용자 역할이 있는 사용자는 오프라인 응용 프로그램을 열고 사용할 수 있다. 이 역할에는 모바일 오프라인 프로필 테이블에 대한 읽기 권한이 있다.

3. 오프라인모드가 작동되기 원하는 테이블 편집창에서 설정에서 '오프라인 변경 가능'을 활성화한다.

![스크린샷 2023-08-08 163442](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/de187873-c631-4e69-b1b6-f1322e50e002)

4. 모델기반 앱의 편집창을 열고 '설정 -> 기능 -> 앱 디자이너의 오프라인 설정' 을 사용한다.

![스크린샷 2023-08-08 170112](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/0d17bd2f-9941-4765-b924-9eb64bd08e1d)

5. '일반 -> 오프라인으로 사용할 수 있음'을 체크한다. 그리고 프로필을 선택하는데 '++ 현재 앱 데이터로 새 프로필 만들기'로 새로 만든다.

![스크린샷 2023-08-08 170910](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/dde5d025-9c8f-4cb7-8de5-4baf0fb3dcac)

6. 프로필 이름을 이력후 오프라인용 데이터 테이블을 선택한다. 그후 그 테이블에서 어떤 레코드를 저장할지 설정할 수 있다. 사용자와 관련있는 레코드를 필터링하여 캐시 메모리를 줄일 수 있다. 그리고 각 테이블마다 동기화 간격을 지정할 수 있다. 이후 프로필을 저장하고 선택해준다. 또한 모델기반앱을 게시한다.

![스크린샷 2023-08-09 091310](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/62c6c0de-33ef-431d-b189-9e27c92adfc7)
![스크린샷 2023-08-09 091940](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/474c2c2f-3ecd-46de-a8c6-d052e0f20900)
![스크린샷 2023-08-09 094819](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/9e1cbcbb-f08b-4b5e-99b1-55d47c463942)

7. D365 앱을 연다. 앱에서 로그인하고 해당 환경앱을 열면 구형 아이콘이 있다. 해당 아이콘을 클릭한다.

![Screenshot_20230809_100249_Dynamics 365 for phones](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/1877329b-c068-4e39-8c8c-8e874ba8f2ed)

8. 오프라인 모드에서 작업을 체크하면 오프라인모드를 사용 가능하다. 이때 캐시 메모리에 레코드 데이터를 다운로드하게된다.(온라인에서 인터넷이 끊겼다고 자동으로 오프라인모드가 되지 않는다)

![Screenshot_20230809_140401_Dynamics 365 for phones](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/ebc5db02-5208-4bc1-8721-ca04ef51e65d)

9. 오프라인모드가 시작되었을시 인터넷에 연결되어 있다면 캐시메모리에 레코드들의 데이터들을 저장하게 된다.

![Screenshot_20230808_092425_Dynamics 365 for phones](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/5e218694-b174-4e52-bdbe-0661b3f74ff7)

10. 이후 오프라인 모드에서는 오프라인 모드일시 검색할 수 있는 레코드들을 앱에서 볼 수 있다.(오프라인 모드에서 사용하도록 지정해두지 않으면 검색할 수 없다.)

## 오프라인 모드에서 사용 가능한 것
> 오프라인 모드에서는 기능이 제한된다. CURD만 가능하고 기능 자체를 사용할 수 없는 것도 존재한다.

1. 오프라인모드가 가능한 테이블은 레코드의 추가,삭제,수정이 가능하다.

2. 오프라인모드에서 수정된 레코드는 온라인 모드로 변경되었을 시 업데이트 된다.

## 오프라인 모드에서 사용 불가능 한 것

* 레코드에 대한 Excel 내보내기, 팔로우, 전자 메일로 링크 보내기, 계층 구조 보기, 할당, 암호 변경, 초대장 만들기, 병합 등의 추가 기능

![Screenshot_20230808_101034_Dynamics 365 for phones](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/535486dc-82f3-42fe-866b-bf53cfc24946)

* 비지니스 프로세스 흐름

* 우량으로 선별(잠재고객)

* 특정 테이블 보기(이메일, 작업, 약속, 전화 통화 등)을 포함한 오프라인에서 사용 할 수 없는 테이블(관련 엔터티)

* 계산 및 롤업 필드 -> Power FX로 생성하는 필드도 문제가 있다. 하지만 동기화시에는 계산되는 것으로 확인된다.

* 이해 관계자, 경쟁 업체 및 영업 팀 영업 기회 추가

* 영업(제품) 제안

* 제품 속성관련 엔터티(DynamicProperty, DynamicPropertyInstance, DynamicPropertyOptionSetItem 및 ProductSubstitute)는 즉시 오프라인으로 사용할 수 없다. 오프라인 모드에서 제품 속성을 사용하려면 이러한 엔터티를 오프라인으로 활성화하고 오프라인 프로필에 추가해야 한다.

* 웹 리소스 -> 양식 처리기, 양식 스크립트 및 리본 명령에 사용되는 웹 리소스는 지원한다. 즉 클라이언트 JS를 실행하는 정도는 가능하다.

## 충돌

* 오프라인 모드를 해제하면 레코드에 따라 충돌이 일어난다. 충돌이 일어나면 오류 메시지를 앱에서 확인 할 수 있으며 동기화 오류 페이지에서 어떤 레코드에서 충돌이 났는지 확인 가능하며 레코드가 남아 있다면 수정이 가능하다.

![Screenshot_20230810_132012_Dynamics 365 for phones](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/80710b38-7cf2-41ea-83b5-eb3f9e5cfe71)
![Screenshot_20230810_143901_Power Apps](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/4e046e8f-cd45-42ce-8e74-13bacf22d436)
![스크린샷 2023-08-10 164442](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/551c48b6-bd59-4213-aa73-01be07f3abce)
![스크린샷 2023-08-10 164511](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/1c005767-ea0c-4f25-85ea-ef5f8343a7c0)

* 온라인에서 삭제를 진행한 레코드는 오프라인에서 수정을 하였다고 수정한 레코드로 만들 수 없다. 삭제 레코드는 이미 일어나서 해당 레코드를 찾을 수 없기에 이후 수정이 불가능하다. 가능하면 삭제는 온라인에서 실행해야한다.

* 온라인에서 변경내용만을 우선시 하려면 다음 설정을 해제한다. 이러면 오프라인에서 반영한 내용은 충돌시 적용되지 않는다.

![스크린샷 2023-08-10 165423](https://github.com/nanenchanga53/PowerPlatforms/assets/39551265/117bfd50-2033-49f5-8145-1bd46e9d8bba)


## 대표적 충돌이 일어날 수 있는 상황

|충돌|설명|비고|
|---|---|---|
|동시 수정|오프라인 모드에서 두 명 이상의 사용자가 같은 레코드를 수정하는 경우 충돌이 발생|오프라인 우선모드라도 충돌 오류가 난다.|
|레코드 삭제 및 수정|오프라인에서 레코드를 수정하거나 삭제하고, 온라인에서 다른 사용자가 동시에 같은 레코드를 수정하거나 삭제하는 경우|우선 온라인 우선으로 저장되고 충돌은 따로 오류가 난다. 온라인 사용자는 확인하지 못할 수 있다. 주의|
|관련 데이터 수정|두 개 이상의 레코드가 서로 연관되어 있을 때, 한 레코드를 수정하고 다른 레코드를 동시에 수정하는 경우 충돌이 발생|예를 들어 계약 레코드와 관련된 고객 정보를 동시에 수정하는 경우|

## sales 오프라인 모드 특징

1. **고객 관리:** 고객 정보에 접근하여 편집이 가능
2. **오프라인 활동:** 예약된 회의 및 활동 정보를 확인하고 업데이트할 수 있다.
3. **제품 정보:** 제품 및 서비스 정보를 확인하고 견적을 작성할 수 있다.
4. **리드 관리:** 리드 정보를 생성하고 편집할 수 있다.
5. **판매 프로세스:** 오프라인에서도 판매 기회를 생성하고 추적할 수 있다.

## Field Service 오프라인 모드 특징

1. **작업 관리:** 오프라인 모드에서 작업을 생성하고 할당
2. **자원 할당:** 필드 서비스 팀원의 할당 정보와 스케줄을 확인하고 수정
3. **작업 승인:** 오프라인 모드에서 작업에 대한 승인 프로세스를 관리하고 진행
4. **고객 지원:** 오프라인 모드에서도 고객 문의사항을 추적하고 해결
5. **부품 관리:** 작업에 필요한 부품 및 자재의 재고 및 사용 여부를 확인하고 관리
6. **작업 보고서:** 작업 완료 후 오프라인 모드에서 작업 보고서를 생성하고 저장



## 추가

* 데이터 병합이 필요한 경우 오류 등으로 알려주질 않기 때문에 병합 관리자가 따로 필요할 수 있다.

* 데이터 병합으로 오프라인모드에서 수정하던 데이터가 사라져서 충돌 에러가 날 수 있다.